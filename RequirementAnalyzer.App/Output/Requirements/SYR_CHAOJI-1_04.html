<a href='D:\Code_Projects\RequirementAnalyzer\RequirementAnalyzer.App\Output\Index.html'>Home</a><h1>SYR_CHAOJI-1_04</h1></br><li>1.1.32.4 SYR_CHAOJI-1_04 : provide functionality in SW for transmission of Long Message to Charger</br></li><li>1.1.32.4.1 Description</br></li><li>1.1.32.4.1.0-1 Brief description: 
Supplier-SW (at TP layer) shall initiate the transmission of LM message by triggering connection establishment frame on DC-CAN bus. Then, it proceeds with actual data-transmission on bus.</br></li><li>1.1.32.4.1.0-2 Preconditions: Vehicle is coded as Chaoji vehicle (VehChrTypDC = 4).  BMW_nr_DcCanProtReq is set to 2 (Chaoji vehicle charges at chaoji-1 charger).</br></li><li>1.1.32.4.1.0-3 Trigger: Transmission Request from upper layer (when send trigger is set for LM message as in SYR_CHAOJI-1_01)</br></li><li>1.1.32.4.1.0-4 Input data: Message data reference and identifier


******
(change for new draft CDV2)
https://ccu-svn.microfuzzy.com/CCU_G26/SP21/SP21_SOP_2207/ENG.02_SystemRequirementsAnalysis/ENG.02_SystemRequirementSpecification/AdditionalDocuments/Charging_Interface/ChaoJi-1/CCU-31198
new DBC in sprint.2219
https://asc-prod-ha-wig.bmw.com/svn/asc271/Projects/CCUP_BEV21/branches/CCUBEV21_2219/BMW/Doc/NK/PATCH_v1_EADBN-1710_220324_DBC_EAPC_DC_CAN.dbc

Note: new DBC is integrated in SW. 
In accordance with new draft CDV2, there is change in values of CAN identifiers of all messages.
a) change in CAN addresses for charger and CCU
b) change in PDU format (PF) values for all message types

*******
</br></li><li>1.1.32.4.1.0-5 Description of behaviour:
When at TP-SW (new supplier SW at transport layer in stack), request for transmission of Long Message is received from upper-layer (PduR). Then, 
1. Connection Establishment Phase
TP-SW shall trigger the connection establishment frame i.e. LM (sequence no. = 0), on the DC-CAN bus. Supplier-SW (at RTE) updates the LIM-C via ACK status interface as “1: Sending Started”. With sending of this frame, vehicle (CCU) indicates its wish to charger that data-frames will be sent afterwards once connection is successfully established.
Based on LM data-length, TP-SW shall set first frame data-fields i.e. sequence number (0), total number of frames (including excluding connection establishment frame) and total number of bytes (bytes sent in data frames starting from SN1 till SNn excluding unused bytes). 
Entire LM transmission time is configured as 10 sec (LM T3) and Message timeout is configured as 100ms (LM T2). These timers shall be started and monitored when first frame is triggered. 
TP-layer shall wait for ACK (info: all ACKs have same 29-bit identifier) from Charger for successful connection establishment. When ACK (Control Frame, data field 1st byte : 1) received within message timeout, frame data-fields validation shall be done and shall trigger data-transmission accordingly.
2. Data Transmission
When ACK is successfully processed within LM T2, TP-SW shall start the consecutive data frame-transmission with 7 bytes of data field per frame (first byte in first frame is PGI and unused fields in last frame shall be set as FF). 
Transmission interval between each consecutive data frame shall be less than 10ms (LM T1). 
3. End of ACK is received and update to LIM-C
After data-transmission, TP-SW shall wait for end of acknowledgement (Control Frame, data field 1st byte : 3) from charger within LM T2. TP-SW identifies this ACK and updates Supplier-SW (at RTE level). Supplier-SW (at RTE) updates the LIM-C via ACK status interface as “3: Message sent, ACK received”. Reset internal states and timers which means TP-SW moves to connection closed state.

Note as per CDV2: In LM End of ACk, Total number of frames includes SN0 with data frames (SN1 to SNn), Total number of bytes should be same as in SN0 frame.</br></li><li>1.1.32.4.1.0-6 Timing Requirements: Timeouts are applicable.
LMS T1 = 10ms, LMS T2 = 100ms and LMS T3 = 10sec	</br></li><li>1.1.32.4.1.0-7 Output data:
LM (SN0), ACK (for LM (0)), Data frames (SNn) and ACK (EndofAck) shall be present on bus.
ACK status interface shall be updated.</br></li><li>1.1.32.4.1.0-8 Postconditions: NA		</br></li><li>1.1.32.4.1.0-9 Descriptions of exceptions: "Suspend transmission" use case is not in scope. 
Based on this statement from standard, "The time interval
LMS_T1 between data frames of message sent shall be less than 10ms (to be discussed)" --> Min. acceptable interval between data frames is not covered/defined.


Strict check on unused data bytes in a frame (such as 0xFF in ACK, EndofAck) is not desired.</br></li><li>1.1.32.4.1.0-10 Dependencies and interactions: Supplier-SW (Chaoji-Adaptor), RTE, COM, CAN IF, PduR, Supplier-SW (ChaojiTp), BSWM</br></li><li>1.1.32.4.2 Differences to CRS</br></li><li>1.1.32.4.2.0-1 xxx</br></li><li>1.1.32.4.3 Questions and Answers</br></li><li>1.1.32.4.3.0-1 xxx</br></li>