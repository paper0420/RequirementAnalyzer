<a href='D:\Code_Projects\RequirementAnalyzer\RequirementAnalyzer.App\Output\Index.html'>Home</a><h1>SYR_CCS_611</h1></br><li>1.1.31.25 SYR_CCS_611 : Provide support for ISO 15118 Plug-and-Charge V2G sequence</br></li><li>1.1.31.25.1 Description</br></li><li>1.1.31.25.1.0-1 Brief description: 
This SYR describes that CCU shall be able communicate with EVSE using V2G PnC DC/-AC message sequence. </br></li><li>1.1.31.25.1.0-2 Preconditions:  PLC chip boot-up done.
Cable plugged-in. SLAC process done. 5% CP duty for digital communication. CP state B is detected.</br></li><li>1.1.31.25.1.0-3 Trigger: BMW appl. initiates the communication
FunctionControl = ChargingMode</br></li><li>1.1.31.25.1.0-4 Input data: Refer ISO 15118-2 Ed1 standard for requirements (ex. TLS, V2G messaging sequence, timeouts, Error codes, XML signature, Encryption/Decryption, Certificate Management)
Also ref,
Figure 108 — Overview DC Request-Response Message Sequence PnC Identification Mode in ISO 15118-2 and Figure 102 — EVCC Communication states for DC V2G messaging)</br></li><li>1.1.31.25.1.0-5 Description of behaviour: 
This SYR enables that CCU shall be able to establish V2G charging session with EVSE baed on ISO 15118-2 based Plug-and-Charge sequence 

Refer below sequence:
https://ccu-svn.microfuzzy.com/CCU_G26/SP21/SP21_SOP_2207/ENG.02_SystemRequirementsAnalysis/ENG.02_SystemRequirementSpecification/AdditionalDocuments/Charging_Interface/CCS/PnC/20211025-CCU-29870.pdf

CCU SW shall be able to access and read stored V2G Root CA certificates from NVM. 
CCU SW shall establish secured TLS communication with EVSE. 
∙	CCU act as TLS client and EVSE act as TLS server.
∙	CCU shall send list of V2G root certs to EVSE in Client Hello.
∙	CCU shall validate the SECC certificate chain of the EVSE using V2G Root CA certificates.
∙	CCU shall verify SECC certificate domain component as „CPO“.
∙	CCU shall support one of the CIPHER suites 
(TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA256, TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256)
∙	Transmission of TLS Master Secret and Client Random (3 times) as UDP frames (using SW API Tls_GetMasterSecret). UDP frames are to be sent only when CCU is Engineering or Plant mode but never in Field mode. 
      Refer Change in EPIC CCU-31907: https://ccu-svn.microfuzzy.com/CCU_G26/SP21/SP21_SOP_2207/ENG.02_SystemRequirementsAnalysis/ENG.02_SystemRequirementSpecification/AdditionalDocuments/Charging_Interface/CCS/PnC/MF_Concept_Plug&Charge_CCU-31907_CCU-30877.pptx
      Refer "Descriptions of Exceptions" trigger details.
 
CCU SW shall read the valid unix timestamp during TLS conn. or during certificate validity checks.

**
CCU SW shall be able to access and read stored Contract Certificate Chain (includes leaf contract cert, subCA1 & subCA2) from NVM. CCU SW shall be able to access and read the stored OEM prov. certificate from NVM. Since private keys of Contract Certificates. and private key for OEM prov. certificate are to be stored in HSM. CCU SW shall be able to perform ECDSA signature algorithm (creation of digital signatures, verification of signatures) and ECDH protocol with algorithm AES-CBC-128 (session key derivation for decryption of encrypted private keys) in HSM or in Host (for verification mainly). 
**
CCU SW shall implement multi-contract selection mechanism. With this, CCU SW shall be able to select one specific contract certificate chain (with associated private key) from the stored multiple contract certificates (with associated keys), to be used during V2G session. 

**
An OEM Provisioning Certificate enables an EV to request a valid new Contract Certificate from EVSE during on-going V2G session. OEM prov. cert is sent to EVSE in CertificateInstallationReq from CCU. Also, the body element of CertificateInstallationReq is signed using OEM prov. certificate (with associated private key). 
Similarly, when certificate update is required during on-going V2G session, existing contract certificate chain is sent to EVSE in CertificateUpdateReq. Also, the body element of CertificateInstallationReq is signed using contract certificate (with associated private key). 
**
Additionally, CCU SW shall verify the signature of the CertificateInstallation/UpdateRes Message using the SAProvisioningCertificateChain, validate the said chain, validate the domain component "CPS" and ensure that it traces back to a valid V2G Root Certificate.
In CertificateInstallation/UpdateRes, CCU receives the encrypted contract certificate key which shall be decrypted by generating a session key (shared secret). After decryption, CCU SW shall validates the key pair (private key, public key). Then, certificate chain shall be stored in NVM and key shall be stored in HSM. 
  
**
With Contract Certificate chain, EV authenticates itself at charging station i.e., PaymentDetailsReq/-Res & AuthorizationReq/-Res). In PaymentDetailsReq, CCU SW shall send its contract certificate chain (leaf contract certificate and sub CAs) with EMAID. Also, at CCU, the contract certificate (associated private key) is used to sign the data exchange from EV to Secondary Actor via EVSE, for example, when EV to send Gen Challenge (received in PaymentDetailsRes) in AuthorizationReq, EV shall sign the body element of AuthorizationReq using Contract Certificate (associated Private key).
**
In ChargerParameterDiscovery Res, when SalesTariff tables are present (in SASCheduleTupleList), CCU SW shall verify the signature in ChargeParameterDiscoveryRes using the Mobility Operator Sub-CA2 certificate (from the contract certificate chain). 
**
When ReceiptRequired is set to True in ChargingStatusRes or CurrentDemandRes,
CCU SW shall send MeteringReceiptReq to EVSE. CCU SW shall sign the body MeteringReceiptReq message using the private key belonging to the selected Contract Certificate (i.e. Contract Cert. Chain sent in PaymentDetailsReq).

**

In CCU SW, BSW configurations shall be done for involved modules (mainly Scc, Exi , Xmlsecurity, Tls, CSM, Cryif, Crpyto, NVM blocks reference), configuration for contracts, timeout handling, read/write to NVM blocks, callback parameters, PANA adaptation layer update.   

Supplier-SW shall use Get / Set callbacks from stack. With "Get" callback, message parameter value is received from BMW Appl. (via RTE interface) and send it to EVSE in request during charging session.
With "Set" callback, message parameter value received in response from EVSE is send to BMW appl. via RTE interface.
https://ccu-svn.microfuzzy.com/CCU_G26/SP21/SP21_SOP_2207/ENG.02_SystemRequirementsAnalysis/ENG.02_SystemRequirementSpecification/AdditionalDocuments/Charging_Interface/CCS/interface/LIM-HW_Information_v1.xlsx
</br></li><li>1.1.31.25.1.0-6 Timing Requirements: define by ISO 15118-2 (edition-1)</br></li><li>1.1.31.25.1.0-7 Output data: defined by ISO 15118-2 (edition 1)</br></li><li>1.1.31.25.1.0-8 Postconditions: PnC charging (DC/AC) session is established between EV and EVSE</br></li><li>1.1.31.25.1.0-9 Descriptions of exceptions:
1. OCSP mechanism is out of scope of Meta.2145 SW.
2. BAC integration is not planned for Meta.2145 hence dummy OEM provisioning certificate and associated private key will be written in the CCU at the startup.
3. Transmission of TLS Master Secret (3 times) over UDP (using SW API Tls_GetMasterSecret) :
 3.a BMW requirement "Integrate vTLS to be able to send TLS MasterSecret 3 times at the end of charging over UDP"
 3.b Observation with new TLS: If the master secret Udp frame is triggered after the V2G sequence is complete/finished, nothing would be transmitted on bus (in the old Tls, implementation from Vector was not done fully for this feature). Therefore in 2151, TLS master secret UDP frame will be transmitted after TLS handshake (this is to make sure test logs can be decrypted for analysis). 

</br></li><li>1.1.31.25.1.0-10 Dependencies and interactions: SCC stack, PANA Appl., RTE, HSM, CSM, CRY IF, CRY DRV, NVM</br></li><li>1.1.31.25.2 Differences to CRS</br></li><li>1.1.31.25.2.0-1 xxx</br></li><li>1.1.31.25.3 Questions and Answers</br></li><li>1.1.31.25.3.0-1 xxx</br></li>